/* Author: Drew Chase */
function openCreateDatabaseEntryPopup(){closePopup(),openPopup("create-database-entry-popup")}function loadDatabaseImages(){let e=$("#icon-list.list");$.get("/api/locations.php?action=get-images",a=>{if(a.error)console.error(`Error loading database images: ${a.error}`);else{e.html("");for(let t=0;t<a.length;t++){let o=a[t];e.append(`\n                <div class="list-item" onclick="selectDatabaseImage(this)" name="${o.file}">\n                    <img src="${o.url}" alt="${o.name}">\n                    <span>${o.name}</span>\n                </div>\n            `)}}})}function submitCreateDatabaseEntry(){let e=$("#create-database-entry-popup.popup input[name='name']").val(),a=$("#create-database-entry-popup.popup input[name='location']").val(),t=$("#create-database-entry-popup.popup input[name='po']").val(),o=$("#icon-list.list .list-item.selected").attr("name");null==o&&(o="");let s=rows.join(";");$.ajax("/api/locations.php",{method:"POST",data:{name:e,location:a,po:t,image:o,rows:s},success:e=>{e.error&&(console.error(`Error creating database entry: ${e.error}`),$("#create-database-entry-popup.popup .error").html(`ERROR: ${e.error}`)),closePopup(),database.loadList(e.id)},error:(e,a,t)=>{console.error(`Error creating database entry: ${t}`),$("#create-database-entry-popup.popup .error").html(`ERROR: ${t}`),closePopup()}})}function selectDatabaseImage(e){(e=$(e)).hasClass("selected")?e.removeClass("selected"):($("#icon-list.list .list-item.selected").removeClass("selected"),e.addClass("selected"))}function addRow(){let e=$("input[name='rows']"),a=e.val();nrows=a.split(",");for(let e=0;e<nrows.length;e++){let a=nrows[e].toLowerCase().trim().replace(/\s/g,"_").replace(/[^a-z_]/g,"");a.endsWith(",")&&(a=a.substring(0,a.length-1)),""!=a&&rows.push(a)}e.val(""),updateRowsList()}function updateRowsList(){$(".row-items").html("");let e=0;rows.forEach(a=>{$(".row-items").append(`<span class="row-item" onclick="removeRow(${e})" title="Remove '${a}'">${a}</span>`),e++})}function removeRow(e){rows.splice(e,1),updateRowsList()}function handleCreateDatabaseEntryUpload(e,a){let t=$("#create-database-entry-popup.popup input[name='name']"),o=$("#create-database-entry-popup.popup input[name='location']"),s=$("#create-database-entry-popup.popup input[name='po']");t.val(a),o.val(""),s.val(""),rows=Object.keys(e),updateRowsList()}$("input[name='rows']").on("keyup",e=>{"Enter"!=e.key&&","!=e.key||(e.preventDefault(),addRow())}),$("#create-database-entry-popup.popup .form-input").on("submit",e=>{e.preventDefault(),$("input[name='rows']").is(":focus")||submitCreateDatabaseEntry()}),loadDatabaseImages();