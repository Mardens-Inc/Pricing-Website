/* Author: Drew Chase */
function showAddPricingListItem(){$("#upload-pricing-data-button").css("display","none"),closePopup(),openPopup("create-pricing-entry-popup"),$("#upload-pricing-data").on("upload",(i,e)=>{let o="";if(e.name.endsWith(".xlsx")){let i=new FileReader;i.readAsBinaryString(e.file),i.onload=(()=>{let e=Parser.ExcelToCSV(i.result);showComparison(o=Parser.CSVToJSON(e))})}else{if(!e.name.endsWith(".csv"))return void alert("Invalid file type");showComparison(o=Parser.CSVToJSON(e.content))}})}function showComparison(i){loadedJson=i;let e=$("#comparison-form"),o="",t=Object.keys(i),p="";p+='<option value="none">none</option>',t.forEach(i=>{p+=`<option value="${i}">${i}</option>`}),database.columns.forEach(i=>{o+=`\n        <div class="row fill comparison-input" column="${i}">\n            <span class="fill">${i}</span>\n            <span class="fill">&#10142;</span>\n            <select class="fill" name="${i}">${p}</select>\n        </div>`}),e.html(o),$("#upload-pricing-data-button").css("display","")}function showEditPricingListOptions(){closePopup(),openPopup("edit-pricing-options-popup"),$("#edit-pricing-options-popup #icon-list.list .list-item.selected").removeClass("selected"),$(`#edit-pricing-options-popup #icon-list.list .list-item[name="${database.listData.image}"]`).addClass("selected");let i=$("#edit-pricing-options-popup #icon-list.list .list-item.selected");0!=i.length&&$("#edit-pricing-options-popup #icon-list.list").scrollTop(i[0].offsetTop-50),$("#edit-pricing-options-popup input[name=name]").val(database.listData.name),$("#edit-pricing-options-popup input[name=location]").val(database.listData.location),$("#edit-pricing-options-popup input[name=po]").val(database.listData.po),$("#edit-pricing-options-popup toggle[name='print']").attr("value",1==database.options.print),$("#edit-pricing-options-popup toggle[name='voice-search']").attr("value",1==database.options["voice-search"]),$("#edit-pricing-options-popup .print-form").css("display",1==database.options.print?"":"none"),$("#edit-pricing-options-popup .voice-form").css("display",1==database.options["voice-search"]?"":"none"),$("#edit-pricing-options-popup input[name='print-label']").val(database.options["print-label"]),$("#edit-pricing-options-popup input[name='print-year']").val(database.options["print-year"]);let e="";for(let i=0;i<database.columns.length;i++)e+=`<option value="${database.columns[i]}">${database.columns[i]}</option>`;$("#edit-pricing-options-popup select#print-price-column").html(e),$("#edit-pricing-options-popup select#print-price-column").val(database.options["print-price-column"]),$("#edit-pricing-options-popup select#voice-price-column").html(e),$("#edit-pricing-options-popup select#voice-price-column").val(database.options["voice-price-column"]),$("#edit-pricing-options-popup select#voice-description-column").html(e),$("#edit-pricing-options-popup select#voice-description-column").val(database.options["voice-description-column"])}function editPricingListOptions(){let i=$("#edit-pricing-options-popup input[name=name]").val(),e=$("#edit-pricing-options-popup input[name=location]").val(),o=$("#edit-pricing-options-popup input[name=po]").val(),t=$("#edit-pricing-options-popup #icon-list.list .list-item.selected").attr("name"),p={print:"true"===$("#edit-pricing-options-popup toggle[name='print']").attr("value"),"voice-search":"true"===$("#edit-pricing-options-popup toggle[name='voice-search']").attr("value"),"print-label":$("#edit-pricing-options-popup input[name='print-label']").val(),"print-year":$("#edit-pricing-options-popup input[name='print-year']").val(),"print-price-column":$("#edit-pricing-options-popup select#print-price-column").val(),"voice-price-column":$("#edit-pricing-options-popup select#voice-price-column").val(),"voice-description-column":$("#edit-pricing-options-popup select#voice-description-column").val()};database.editList(i,e,o,t,p)}function openListItemOptions(i){selectedElement=i,database.options=JSON.parse(database.listData.options),closePopup(),openPopup("list-item-options-popup"),$("#list-item-options-popup.popup #print-button").css("display",database.options.print?"":"none")}function print(){if(null==selectedElement)return;let i=$(selectedElement).find(`.location-${database.options["print-price-column"]}`).text().replace("$",""),e=window.open(`/print.php?title=${database.options["print-label"]}&year=${database.options["print-year"]}&price=${i}`,"Print Window","width=800,height=600");e.addEventListener("load",()=>e.print()),e.addEventListener("blur",()=>e.close()),closePopup()}var selectedElement=void 0;$("#upload-pricing-data-button").on("click",i=>{i.preventDefault();let e={};$(".comparison-input").each((i,o)=>{let t=$(o).attr("column"),p=$(o).find("select").val();if("none"==p)return;let n=loadedJson[p];e[t]=n}),closePopup(),openPopup("loading-popup"),$.ajax(`/api/location.php?id=${database.list}`,{method:"POST",data:JSON.stringify(e),success:i=>{if(i.error)return console.error(`Error uploading pricing data: ${i.error}`),alert(`Error uploading pricing data: ${i.error}`),void closePopup();database.loadList(database.list),closePopup(),alert(`Added: ${i.inserted} items\nFailed: ${i.failed} items`)},error:(i,e,o)=>{console.error(`Error uploading pricing data: ${o}`),alert(`Error uploading pricing data: ${o}`),closePopup()}})}),$("#upload-row-data").on("upload",(i,e)=>{let o="";if(e.name.endsWith(".xlsx")){let i=new FileReader;i.readAsBinaryString(e.file),i.onload=(()=>{let t=Parser.ExcelToCSV(i.result);o=Parser.CSVToJSON(t),handleCreateDatabaseEntryUpload(o,e.name)})}else{if(!e.name.endsWith(".csv"))return void alert("Invalid file type");o=Parser.CSVToJSON(e.content),handleCreateDatabaseEntryUpload(o,e.name)}}),$("#edit-pricing-options-popup toggle[name='print']").on("toggle",(i,e)=>{$("#edit-pricing-options-popup .print-form").css("display",e.value?"":"none")}),$("#edit-pricing-options-popup toggle[name='voice-search']").on("toggle",(i,e)=>{$("#edit-pricing-options-popup .voice-form").css("display",e.value?"":"none")});