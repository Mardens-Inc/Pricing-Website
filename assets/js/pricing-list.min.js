/* Author: Drew Chase */
function showAddPricingListItem(){$("#upload-pricing-data-button").css("display","none"),closePopup(),openPopup("create-pricing-entry-popup"),$("#upload-pricing-data").on("upload",(t,e)=>{let i="";if(e.name.endsWith(".xlsx")){let t=new FileReader;t.readAsBinaryString(e.file),t.onload=(()=>{let e=Parser.ExcelToCSV(t.result);showComparison(i=Parser.CSVToJSON(e))})}else{if(!e.name.endsWith(".csv"))return void alert("Invalid file type");showComparison(i=Parser.CSVToJSON(e.content))}})}function showComparison(t){loadedJson=t;let e=$("#comparison-form"),i="",o=Object.keys(t),p="";p+='<option value="none">none</option>',o.forEach(t=>{p+=`<option value="${t}">${t}</option>`}),database.columns.forEach(t=>{i+=`\n        <div class="row fill comparison-input" column="${t}">\n            <span class="fill">${t}</span>\n            <span class="fill">&#10142;</span>\n            <select class="fill" name="${t}">${p}</select>\n        </div>`}),e.html(i),$("#upload-pricing-data-button").css("display","")}function showEditPricingListOptions(){closePopup(),openPopup("edit-pricing-options-popup"),$("#edit-pricing-options-popup #icon-list.list .list-item.selected").removeClass("selected"),$(`#edit-pricing-options-popup #icon-list.list .list-item[name="${database.listData.image}"]`).addClass("selected");let t=$("#edit-pricing-options-popup #icon-list.list .list-item.selected");0!=t.length&&$("#edit-pricing-options-popup #icon-list.list").scrollTop(t[0].offsetTop-50),$("#edit-pricing-options-popup input[name=name]").val(database.listData.name),$("#edit-pricing-options-popup input[name=location]").val(database.listData.location),$("#edit-pricing-options-popup input[name=po]").val(database.listData.po),$("#edit-pricing-options-popup toggle[name='print']").attr("value",1==database.options.print),$("#edit-pricing-options-popup toggle[name='voice-search']").attr("value",1==database.options["voice-search"]),$("#edit-pricing-options-popup .print-form").css("display",1==database.options.print?"":"none"),$("#edit-pricing-options-popup .voice-form").css("display",1==database.options["voice-search"]?"":"none"),$("#edit-pricing-options-popup input[name='print-label']").val(database.options["print-label"]),$("#edit-pricing-options-popup input[name='print-year']").val(database.options["print-year"]);let e="";for(let t=0;t<database.columns.length;t++)e+=`<option value="${database.columns[t]}">${database.columns[t]}</option>`;$("#edit-pricing-options-popup select#print-price-column").html(e),$("#edit-pricing-options-popup select#print-price-column").val(database.options["print-price-column"]),$("#edit-pricing-options-popup select#voice-price-column").html(e),$("#edit-pricing-options-popup select#voice-price-column").val(database.options["voice-price-column"]),$("#edit-pricing-options-popup select#voice-description-column").html(e),$("#edit-pricing-options-popup select#voice-description-column").val(database.options["voice-description-column"])}function editPricingListOptions(){let t=$("#edit-pricing-options-popup input[name=name]").val(),e=$("#edit-pricing-options-popup input[name=location]").val(),i=$("#edit-pricing-options-popup input[name=po]").val(),o=$("#edit-pricing-options-popup #icon-list.list .list-item.selected").attr("name"),p={print:"true"===$("#edit-pricing-options-popup toggle[name='print']").attr("value"),"voice-search":"true"===$("#edit-pricing-options-popup toggle[name='voice-search']").attr("value"),"print-label":$("#edit-pricing-options-popup input[name='print-label']").val(),"print-year":$("#edit-pricing-options-popup input[name='print-year']").val(),"print-price-column":$("#edit-pricing-options-popup select#print-price-column").val(),"voice-price-column":$("#edit-pricing-options-popup select#voice-price-column").val(),"voice-description-column":$("#edit-pricing-options-popup select#voice-description-column").val()};database.editList(t,e,i,o,p)}function openListItemOptions(t){printElement=t,database.options=JSON.parse(database.listData.options),closePopup(),$("#list-item-options-popup .title").html(selectedElements.length>1?"Multiple Items Selected":"Selected Item"),openPopup("list-item-options-popup"),$("#edit-list-item-popup").attr("selectedId",$(t).attr("id")),$("#delete-entry-button").attr("onclick",`database.deleteItem("${$(t).attr("id")}")`),$("#select-entry-button").attr("onclick",`selectElement("${$(t).attr("id")}")`),$("#list-item-options-popup.popup #print-button").css("display",database.options.print?"":"none")}function selectElement(t){$(`#${t}`).addClass("selected"),selectedElements.push(t),console.log(selectedElements),closePopup()}function print(){if(null==printElement)return;let t=$(printElement).find(`.location-${database.options["print-price-column"]}`).text().replace("$",""),e=window.open(`/print.php?title=${database.options["print-label"]}&year=${database.options["print-year"]}&price=${t}`,"Print Window","width=800,height=600");e.addEventListener("load",()=>e.print()),e.addEventListener("blur",()=>e.close()),closePopup()}function openEditListItem(){closePopup(),id=$("#edit-list-item-popup").attr("selectedId");let t=$("#edit-list-item-popup .form-input");t.html("");for(let e=0;e<database.columns.length;e++){let i=database.columns[e];if("id"==i||"date"==i)continue;let o=$($(`#${id} .location-${i}`)[0]);if(0==o.length)continue;let p=o.text(),n=$(`<label for="${i}">${i.replace(/_/g," ").toUpperCase()}</label>`),a=$(`<input type="text" name="${i}" value="${p}">`);t.append(n),t.append(a)}let e=$("<button>Save</button>");$(e).on("click",async()=>{let t={id:id};$("#edit-list-item-popup .form-input input").each((e,i)=>{let o=$(i).attr("name"),p=$(i).val();t[o]=p}),t=JSON.stringify(t),await database.editListItem(t),await database.loadList(database.list),closePopup()}),t.append(e),openPopup("edit-list-item-popup")}var printElement=void 0,selectedElements=[];$("#upload-pricing-data-button").on("click",t=>{t.preventDefault();let e={};$(".comparison-input").each((t,i)=>{let o=$(i).attr("column"),p=$(i).find("select").val();if("none"==p)return;let n=loadedJson[p];e[o]=n}),closePopup(),openPopup("loading-popup"),$.ajax(`/api/location.php?id=${database.list}`,{method:"POST",data:JSON.stringify(e),success:t=>{if(t.error)return console.error(`Error uploading pricing data: ${t.error}`),alert(`Error uploading pricing data: ${t.error}`),void closePopup();database.loadList(database.list),closePopup(),alert(`Added: ${t.inserted} items\nFailed: ${t.failed} items`)},error:(t,e,i)=>{console.error(`Error uploading pricing data: ${i}`),alert(`Error uploading pricing data: ${i}`),closePopup()}})}),$("#upload-row-data").on("upload",(t,e)=>{let i="";if(e.name.endsWith(".xlsx")){let t=new FileReader;t.readAsBinaryString(e.file),t.onload=(()=>{let o=Parser.ExcelToCSV(t.result);i=Parser.CSVToJSON(o),handleCreateDatabaseEntryUpload(i,e.name)})}else{if(!e.name.endsWith(".csv"))return void alert("Invalid file type");i=Parser.CSVToJSON(e.content),handleCreateDatabaseEntryUpload(i,e.name)}}),$("#edit-pricing-options-popup toggle[name='print']").on("toggle",(t,e)=>{$("#edit-pricing-options-popup .print-form").css("display",e.value?"":"none")}),$("#edit-pricing-options-popup toggle[name='voice-search']").on("toggle",(t,e)=>{$("#edit-pricing-options-popup .voice-form").css("display",e.value?"":"none")});